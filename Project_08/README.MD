# ğŸš— Segmentation Multi-Classes pour VÃ©hicules Autonomes

## ğŸ“‹ Description du Projet

Ce projet dÃ©veloppe un systÃ¨me de segmentation sÃ©mantique d'images de rue destinÃ© aux vÃ©hicules autonomes. Il permet l'identification et la segmentation automatique de diffÃ©rents Ã©lÃ©ments urbains : vÃ©hicules, piÃ©tons, mobilier urbain, infrastructure routiÃ¨re, etc.

Le systÃ¨me s'inscrit dans une chaÃ®ne complÃ¨te de vision par ordinateur embarquÃ©e pour l'automobile autonome, traitant les images en temps rÃ©el pour alimenter les systÃ¨mes de dÃ©cision.

## ğŸ—‚ï¸ Structure du Projet

```
â”œâ”€â”€ notebooks/
â”‚   â”œâ”€â”€ p8_notebook.ipynb       # Notebook principal d'entraÃ®nement des modÃ¨les
â”‚   â””â”€â”€ content/
â”‚       â””â”€â”€ data/
â”‚           â”œâ”€â”€ new_images_to_predict/     # Images diverses pour tests d'infÃ©rence
â”‚           â””â”€â”€ test_images_sample/        # Ã‰chantillon Cityscapes avec masques
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ utils.py                # Fonctions communes (prÃ©traitement, chargement, infÃ©rence)
â”œâ”€â”€ app/                        # API et Interface Web
â”‚   â”œâ”€â”€ main.py                 # API FastAPI avec routes de segmentation
â”‚   â”œâ”€â”€ streamlit_app.py        # Interface web interactive
â”‚   â””â”€â”€ requirements.txt        # DÃ©pendances pour l'API et l'interface
â”œâ”€â”€ cityscapes_config.json      # Configuration des classes Cityscapes
â”œâ”€â”€ .env.example                # Template de variables d'environnement
â”œâ”€â”€ Dockerfile                  # Configuration Docker
â”œâ”€â”€ docker-compose.yml.example  # Template Docker Compose
â”œâ”€â”€ nginx.conf                  # Configuration reverse proxy
â”œâ”€â”€ start.sh                    # Script de dÃ©marrage des services
â”œâ”€â”€ .dockerignore              # Optimisation du build Docker
â””â”€â”€ README.md
```

> **Note** : Les modÃ¨les entraÃ®nÃ©s sont stockÃ©s et versionnÃ©s via **MLFlow** avec artefacts sur **MinIO**, pas en local.

**Ã‰tat actuel du dÃ©veloppement :**
- âœ… **EntraÃ®nement des modÃ¨les** : Complet (notebook + MLFlow + MinIO)
- âœ… **Fonctions d'infÃ©rence** : DÃ©veloppÃ©es et prÃªtes
- âœ… **API FastAPI** : API complÃ¨te avec endpoints de segmentation
- âœ… **Interface Web** : Interface Streamlit pour upload et visualisation
- âœ… **DÃ©ploiement** : Conteneurisation Docker complÃ¨te + reverse proxy nginx

## ğŸ·ï¸ Classes de Segmentation

Le modÃ¨le identifie **8 catÃ©gories principales** :

1. **Route** - ChaussÃ©e et surfaces roulantes
2. **Trottoir** - Zones piÃ©tonnes
3. **BÃ¢timents** - Structures architecturales
4. **VÃ©gÃ©tation** - Arbres, buissons, espaces verts
5. **VÃ©hicules** - Voitures, camions, bus
6. **Personnes** - PiÃ©tons, cyclistes
7. **Signalisation** - Panneaux, feux de circulation
8. **Mobilier urbain** - Poteaux, barriÃ¨res, abribus

## ğŸ§  Architecture Technique

### ModÃ¨les ImplÃ©mentÃ©s
Utilisation de la bibliothÃ¨que **[segmentation_models](https://github.com/qubvel/segmentation_models)** de qubvel pour l'implÃ©mentation des architectures.

**Architectures principales :**
- **U-Net** : Architecture encoder-decoder classique
- **FPN** (Feature Pyramid Network) : RÃ©seau Ã  pyramide de caractÃ©ristiques

**Backbones testÃ©s :**
```python
# ModÃ¨les avec backbones par dÃ©faut
('U-Net', None)     # Backbone U-Net intÃ©grÃ©
('FPN', None)       # Backbone VGG16 par dÃ©faut

# ModÃ¨les avec backbones prÃ©-entraÃ®nÃ©s (encodeurs gelÃ©s)
('U-Net', 'mobilenetv2')
('U-Net', 'efficientnetb0') 
('FPN', 'mobilenetv2')
('FPN', 'efficientnetb0')
('FPN', 'resnet34')

# Fine-tuning sÃ©lectif (encodeurs entraÃ®nables)
('U-Net', 'mobilenetv2')
('FPN', 'efficientnetb0') 
('FPN', 'resnet34')
```

**StratÃ©gies d'entraÃ®nement :**
- **Encodeurs gelÃ©s** : Transfer learning avec features prÃ©-entraÃ®nÃ©es figÃ©es
- **Fine-tuning** : Ajustement fin des encodeurs prÃ©-entraÃ®nÃ©s
- **EntraÃ®nement from scratch** : Sans prÃ©-entraÃ®nement (backbones par dÃ©faut)

### Stack Technologique
- **Framework** : Keras/TensorFlow
- **Architectures** : [segmentation_models](https://github.com/qubvel/segmentation_models) (qubvel)
- **Gestion des expÃ©riences** : MLFlow
- **Stockage des artefacts** : MinIO (S3-compatible)
- **API** : FastAPI avec validation Pydantic
- **Interface** : Streamlit pour l'interaction utilisateur
- **Reverse Proxy** : nginx pour routage API/Interface
- **DÃ©ploiement** : Docker + NAS personnel *(solutions souveraines)*

## ğŸ“Š Dataset

- **Source** : Cityscapes Dataset
- **Organisation locale** :
  - `notebooks/content/data/test_images_sample/` : Ã‰chantillon avec masques de vÃ©ritÃ© pour tests d'infÃ©rence
  - `notebooks/content/data/new_images_to_predict/` : Images de test diverses pour validation

## ğŸš€ Installation et Configuration

### Option 1: DÃ©ploiement Docker (RecommandÃ©)

#### Configuration rapide
```bash
# Cloner le projet
git clone https://github.com/GrgMdmn/OpenClassrooms_AI_Projects.git
cd OpenClassrooms_AI_Projects/Project_8

# Copier et adapter la configuration
cp .env.example .env
cp docker-compose.yml.example docker-compose.yml

# Ã‰diter les variables d'environnement
nano .env
```

#### Variables d'environnement requises
```bash
# Configuration du serveur
NGINX_PORT=8080

# Configuration MLflow
MLFLOW_TRACKING_URI=http://localhost:5000
MLFLOW_S3_ENDPOINT_URL=http://localhost:9000
AWS_ACCESS_KEY_ID=your_access_key
AWS_SECRET_ACCESS_KEY=your_secret_key

# URL de base de l'API (pour Streamlit)
MULTISEG_API_BASE_URL=http://localhost:8080/api
```

#### DÃ©ploiement
```bash
# Construction et lancement
docker-compose up --build

# Ou en arriÃ¨re-plan
docker-compose up -d --build

# AccÃ¨s Ã  l'application
# Interface web: http://localhost:8080
# API docs: http://localhost:8080/api/docs
# Health check: http://localhost:8080/health
```

#### Test local sans docker-compose
```bash
# Lancement avec port personnalisÃ©
docker build -t multiseg-api .
docker run -p 3000:3000 \
  -e NGINX_PORT=3000 \
  -e MLFLOW_TRACKING_URI=http://host.docker.internal:5000 \
  -e MULTISEG_API_BASE_URL=http://localhost:3000/api \
  multiseg-api
```

### Option 2: Installation Locale (DÃ©veloppement)

#### Pour l'expÃ©rimentation et l'entraÃ®nement
```bash
cd notebooks
pip install -r requirements.txt
```

#### Pour l'API uniquement
```bash
cd app
pip install -r requirements.txt

# Lancement manuel des services
# Terminal 1: FastAPI
uvicorn app.main:app --host 0.0.0.0 --port 8000

# Terminal 2: Streamlit  
streamlit run app/streamlit_app.py --server.port 8501
```

## ğŸŒ Utilisation de l'API

### Endpoints Principaux

#### Segmentation d'image
```bash
# Upload et segmentation via curl
curl -X POST "http://localhost:8080/api/segment" \
  -F "file=@image.jpg" \
  -F "model_name=unet_mobilenetv2" \
  -F "confidence_threshold=0.5"
```

#### Informations sur les modÃ¨les
```bash
# Liste des modÃ¨les disponibles
curl "http://localhost:8080/api/models"

# DÃ©tails d'un modÃ¨le
curl "http://localhost:8080/api/models/unet_mobilenetv2"
```

#### Monitoring
```bash
# Health check
curl "http://localhost:8080/health"

# MÃ©triques API
curl "http://localhost:8080/api/metrics"
```

### Interface Web

L'interface Streamlit accessible sur `http://localhost:8080` permet :
- **Upload d'images** par glisser-dÃ©poser ou sÃ©lection
- **SÃ©lection du modÃ¨le** parmi les modÃ¨les disponibles
- **Ajustement des paramÃ¨tres** (seuil de confiance, etc.)
- **Visualisation** des rÃ©sultats avec overlay des segmentations
- **TÃ©lÃ©chargement** des masques de segmentation

## ğŸ”§ Architecture de DÃ©ploiement

### Structure des Services
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   nginx:8080    â”‚â”€â”€â”€â”€â”‚  FastAPI:8000    â”‚â”€â”€â”€â”€â”‚   MLFlow/MinIO  â”‚
â”‚  (Reverse Proxy)â”‚    â”‚  (API Backend)   â”‚    â”‚ (Model Storage) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Streamlit:8501 â”‚
â”‚ (Web Interface) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Volumes et Persistance
- **ModÃ¨les** : TÃ©lÃ©chargÃ©s depuis MLFlow/MinIO au dÃ©marrage
- **Uploads temporaires** : Stockage en mÃ©moire (pas de persistance)
- **Logs** : Accessibles via `docker-compose logs`

### Monitoring et Logs
```bash
# Logs en temps rÃ©el
docker-compose logs -f

# Logs d'un service spÃ©cifique
docker-compose logs -f multiseg-api

# MÃ©triques de performance
curl http://localhost:8080/api/metrics
```

## ğŸ”® AmÃ©liorations Futures

### ModÃ¨les et Performance
- **PrÃ©traitement adaptatif** : PrÃ©traitement spÃ©cifique Ã  chaque backbone au lieu de la normalisation gÃ©nÃ©rique
- **Optimisation temps rÃ©el** : AmÃ©lioration des performances d'infÃ©rence pour dÃ©ploiement embarquÃ©
- **RÃ©solution d'entraÃ®nement amÃ©liorÃ©e** : L'API accepte toutes les rÃ©solutions d'images, mais l'entraÃ®nement a Ã©tÃ© effectuÃ© sur des images redimensionnÃ©es Ã  224x224. Un rÃ©entraÃ®nement sur des rÃ©solutions supÃ©rieures (512x512, 1024x1024) pourrait amÃ©liorer la prÃ©cision en capturant plus de dÃ©tails fins, au prix d'une augmentation des besoins en puissance de calcul
- **Transfer learning ciblÃ©** : Utilisation de backbones prÃ©-entraÃ®nÃ©s sur Mapillary Vistas

### Infrastructure et DÃ©ploiement
- **Scaling horizontal** : Support Kubernetes pour dÃ©ploiement multi-instances
- **Cache intelligent** : Mise en cache des prÃ©dictions pour images similaires
- **API Gateway** : IntÃ©gration d'un gateway pour authentification et rate limiting
- **Monitoring avancÃ©** : IntÃ©gration Prometheus/Grafana pour mÃ©triques dÃ©taillÃ©es

### DonnÃ©es et GÃ©nÃ©ralisation
- **GÃ©nÃ©ralisation des conditions** : Extension au-delÃ  des conditions urbaines de Cityscapes
- **Segmentation des personnes** : AmÃ©lioration de l'IoU via data augmentation (IA gÃ©nÃ©rative)
- **Datasets additionnels** : IntÃ©gration de datasets complÃ©mentaires pour robustesse

---

*Projet dÃ©veloppÃ© dans une approche de souverainetÃ© technologique, privilÃ©giant les solutions open-source et l'hÃ©bergement sur infrastructure personnelle.*
